<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigator - Portfolio Company Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="min-h-screen w-full flex">
        <!-- Sidebar will load here -->
        <div id="sidebar-container">Loading sidebar...</div>
        
        <!-- Main content area -->
        <div class="flex-1 flex flex-col">
            <!-- Header will load here -->
            <div id="header-container">Loading header...</div>
            
            <!-- Page content -->
            <main id="main-content" class="flex-1 p-6 sm:p-8 overflow-y-auto">
                <div class="flex items-center justify-center h-full">
                    <div class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <h3 class="mt-2 text-lg font-medium text-gray-900">Loading Company Dashboard...</h3>
                        <p class="mt-1 text-sm text-gray-500">Please wait while we load the company information.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Load shared JavaScript FIRST -->
    <script src="js/shared.js"></script>
    
    <script>
        // Get selected company from URL or localStorage
        function getSelectedCompany() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlCompany = urlParams.get('company');
            if (urlCompany) {
                localStorage.setItem('selectedCompany', urlCompany);
                return urlCompany;
            }
            return localStorage.getItem('selectedCompany') || 'all';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Load shared components
            const sidebarContainer = document.getElementById('sidebar-container');
            const sidebarHTML = await ComponentLoader.loadSidebar();
            sidebarContainer.innerHTML = sidebarHTML;
            
            const headerContainer = document.getElementById('header-container');
            const headerHTML = await ComponentLoader.loadHeader();
            headerContainer.innerHTML = headerHTML;
            
            // Update navigation and load company dashboard
            setTimeout(() => {
                Navigation.updateHeaderTitle();
                Navigation.updateCompanySelector();
                Navigation.updateActiveNavigation();
                loadCompanyDashboard();
            }, 100);
        });

        function loadCompanyDashboard() {
            const selectedCompany = getSelectedCompany();
            const mainContent = document.getElementById('main-content');
            
            // Update header title
            const headerTitle = document.getElementById('header-title');
            
            switch(selectedCompany) {
                case 'techflow-solutions':
                    headerTitle.textContent = 'TechFlow Solutions';
                    mainContent.innerHTML = renderTechFlowDashboard();
                    initializeTechFlowInteractions();
                    break;
                case 'cloudvantage':
                    headerTitle.textContent = 'CloudVantage';
                    mainContent.innerHTML = renderCloudVantageDashboard();
                    initializeCloudVantageInteractions();
                    break;
                default:
                    headerTitle.textContent = 'Portfolio Company';
                    mainContent.innerHTML = renderNoCompanySelected();
                    break;
            }
        }

        function renderNoCompanySelected() {
            return `
                <div class="flex items-center justify-center h-full">
                    <div class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <h3 class="mt-2 text-lg font-medium text-gray-900">No Company Selected</h3>
                        <p class="mt-1 text-sm text-gray-500">Please select a portfolio company from the dropdown in the header to view its dashboard.</p>
                    </div>
                </div>
            `;
        }

        function renderTechFlowDashboard() {
            const workstreams = [
                { title: 'Data Extraction', status: 'Completed', statusColor: 'bg-green-100 text-green-800', metrics: [{value: 247, label: 'Documents'}, {value: '1,834', label: 'Data Points'}] },
                { title: 'Anomaly Detection', status: 'In Progress', statusColor: 'bg-sky-100 text-sky-800', alert: true, metrics: [{value: '3', label: 'Critical Flags'}, {value: '12', label: 'Minor Issues'}] },
                { title: 'Valuation Modeling', status: 'Completed', statusColor: 'bg-green-100 text-green-800', metrics: [{value: '$85M', label: 'Valuation'}, {value: '6.8x', label: 'Revenue Multiple'}] },
                { title: 'Synergy Analysis', status: 'In Progress', statusColor: 'bg-sky-100 text-sky-800', metrics: [{value: '67%', label: 'Portfolio Fit'}, {value: '$8.2M', label: 'Synergy Value'}] },
                { title: 'Growth Modeling', status: 'Pending', statusColor: 'bg-violet-100 text-violet-800', metrics: [{value: '-', label: 'Scenarios'}, {value: '-', label: 'Growth Rate'}] },
                { title: 'IC Dashboard', status: 'Pending', statusColor: 'bg-violet-100 text-violet-800', metrics: [{value: 'T-5 Days', label: 'Readiness'}, {value: '5', label: 'Days Remaining'}] }
            ];

            return `
                <div class="space-y-8">
                    <div class="flex flex-wrap justify-between items-center gap-4 pb-6 border-b border-gray-200">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800">TechFlow Solutions</h1>
                            <p class="text-md text-gray-500">Series B SaaS • $55M ARR • Day 9 of 14</p>
                        </div>
                        <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-sky-100 text-sky-800 font-semibold">
                            <span class="relative flex h-3 w-3">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-3 w-3 bg-sky-500"></span>
                            </span>
                            Analysis in Progress
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="text-lg font-semibold text-gray-700">Due Diligence Progress</h2>
                            <span class="font-semibold text-gray-800">65% Complete</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: 65%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                            <span>Day 1</span>
                            <span>Decision Ready (Day 14)</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-8">
                            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                                <h2 class="text-lg font-semibold text-gray-700 mb-4">Live Scorecard</h2>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="text-center bg-gray-50 p-4 rounded-lg">
                                        <p class="text-sm font-medium text-gray-600">Financial Health</p>
                                        <p class="text-2xl font-bold text-green-600">8.4</p>
                                    </div>
                                    <div class="text-center bg-gray-50 p-4 rounded-lg">
                                        <p class="text-sm font-medium text-gray-600">Operations</p>
                                        <p class="text-2xl font-bold text-sky-600">7.8</p>
                                    </div>
                                    <div class="text-center bg-gray-50 p-4 rounded-lg">
                                        <p class="text-sm font-medium text-gray-600">Growth Potential</p>
                                        <p class="text-2xl font-bold text-violet-600">9.1</p>
                                    </div>
                                    <div class="text-center bg-gray-50 p-4 rounded-lg">
                                        <p class="text-sm font-medium text-gray-600">Strategic Fit</p>
                                        <p class="text-2xl font-bold text-amber-600">6.7</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                                <h2 class="text-lg font-semibold text-gray-700 mb-4">Recent Activity</h2>
                                <div class="space-y-3">
                                    <div class="p-3 rounded-md bg-green-50 border border-green-200">
                                        <p class="font-semibold text-sm text-green-800">Valuation Model Complete</p>
                                        <p class="text-xs text-gray-500">2 hours ago</p>
                                    </div>
                                    <div class="p-3 rounded-md bg-red-50 border border-red-200">
                                        <p class="font-semibold text-sm text-red-800">Customer Churn Anomaly Detected</p>
                                        <p class="text-xs text-gray-500">4 hours ago</p>
                                    </div>
                                    <div class="p-3 rounded-md bg-sky-50 border border-sky-200">
                                        <p class="font-semibold text-sm text-sky-800">Synergy Analysis Updated</p>
                                        <p class="text-xs text-gray-500">6 hours ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md border border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4">Diligence Workstreams</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${workstreams.map(ws => `
                                    <div class="relative p-4 border rounded-lg ${ws.alert ? 'cursor-pointer hover:shadow-lg hover:border-blue-400 transition-all' : 'bg-gray-50'}" ${ws.alert ? 'onclick="navigateToAriaWithContext(\'tf-anomalies\')"' : ''}>
                                        ${ws.alert ? '<span class="absolute top-2 right-2 flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span>' : ''}
                                        <div class="flex justify-between items-center mb-3">
                                            <h3 class="font-bold text-gray-800">${ws.title}</h3>
                                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${ws.statusColor}">${ws.status}</span>
                                        </div>
                                        <div class="flex justify-around text-center border-t pt-3">
                                            ${ws.metrics.map(m => `
                                                <div>
                                                    <p class="text-xl font-bold text-gray-800">${m.value}</p>
                                                    <p class="text-xs text-gray-500 uppercase tracking-wider">${m.label}</p>
                                                </div>
                                            `).join('')}
                                        </div>
                                        ${ws.alert ? '<div class="mt-2 text-xs text-blue-600 font-medium">Click to analyze anomalies with Aria →</div>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCloudVantageDashboard() {
            const kpis = [
                { label: 'ARR', value: '$78M', change: '+4% QoQ', changeColor: 'text-green-600' },
                { label: 'Net Revenue Retention', value: '128%', change: '+3% vs Target', changeColor: 'text-green-600' },
                { label: 'EBITDA Margin', value: '31%', change: '-1% vs Target', changeColor: 'text-red-600' },
                { label: 'Rule of 40', value: '58%', change: 'Healthy', changeColor: 'text-green-600' }
            ];

            const programs = [
                { name: 'Enterprise GTM Strategy', dept: 'Sales', status: 'On Track', statusColor: 'bg-green-100 text-green-800', progress: 75 },
                { name: 'ABM Campaign Launch', dept: 'Marketing', status: 'On Track', statusColor: 'bg-green-100 text-green-800', progress: 90 },
                { name: 'Channel Partner Program', dept: 'Partners', status: 'At Risk', statusColor: 'bg-yellow-100 text-yellow-800', progress: 45 },
                { name: 'Platform Scalability Initiative', dept: 'Engineering', status: 'On Track', statusColor: 'bg-green-100 text-green-800', progress: 60 },
                { name: 'AI-Powered Feature Dev', dept: 'Product', status: 'Behind', statusColor: 'bg-red-100 text-red-800', progress: 30 },
                { name: 'Leadership Development', dept: 'HR', status: 'On Track', statusColor: 'bg-green-100 text-green-800', progress: 85 }
            ];

            return `
                <div class="space-y-8">
                    <div class="flex flex-wrap justify-between items-center gap-4 pb-6 border-b border-gray-200">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800">CloudVantage</h1>
                            <p class="text-md text-gray-500">Growth Stage • Q2 2025</p>
                        </div>
                        <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-green-100 text-green-800 font-semibold">
                            <span class="relative flex h-3 w-3">
                                <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                            </span>
                            Healthy
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${kpis.map(kpi => `
                            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                                <p class="text-sm font-bold text-gray-700 mb-1">${kpi.label}</p>
                                <p class="text-3xl font-bold text-blue-600">${kpi.value}</p>
                                <p class="text-sm ${kpi.changeColor} mt-1">${kpi.change}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4">Active Programs</h2>
                        <div class="space-y-3">
                            ${programs.map(p => `
                                <div class="grid grid-cols-12 gap-4 items-center p-3 rounded-md bg-gray-50">
                                    <div class="col-span-12 sm:col-span-3 font-semibold text-gray-800">${p.name}</div>
                                    <div class="col-span-6 sm:col-span-2 text-sm text-gray-600">${p.dept}</div>
                                    <div class="col-span-6 sm:col-span-2">
                                        <span class="text-xs font-semibold px-2 py-1 rounded-full ${p.statusColor}">${p.status}</span>
                                    </div>
                                    <div class="col-span-10 sm:col-span-4">
                                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${p.progress}%"></div>
                                        </div>
                                    </div>
                                    <div class="col-span-2 sm:col-span-1 text-sm font-medium text-gray-700 text-right">${p.progress}%</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4">Quarterly Business Review - Q1 2025</h2>
                        <div class="border-b border-gray-200 mb-4">
                            <nav class="flex -mb-px">
                                <button class="tab-button active" data-tab="summary">Summary</button>
                                <button class="tab-button" data-tab="performance">Performance</button>
                                <button class="tab-button" data-tab="financials">Financials</button>
                                <button class="tab-button" data-tab="initiatives">Strategic Initiatives</button>
                            </nav>
                        </div>
                        <div id="tab-content" class="text-base text-gray-700 space-y-3 leading-relaxed">
                            <p>Q1 was a strong quarter, exceeding top-line revenue targets by 4% and maintaining a healthy Rule of 40 score of 58%. The Enterprise GTM strategy is showing early signs of success, with two major logos landed. Headwinds remain in product development, where the AI feature is behind schedule, and the new Channel Partner program is struggling to gain traction.</p>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4">Departmental Updates</h2>
                        <div class="border-b border-gray-200 mb-4">
                            <nav class="flex -mb-px overflow-x-auto">
                                <button class="dept-tab-button active flex-shrink-0" data-dept="sales">Sales</button>
                                <button class="dept-tab-button flex-shrink-0" data-dept="marketing">Marketing</button>
                                <button class="dept-tab-button flex-shrink-0" data-dept="product">Product</button>
                                <button class="dept-tab-button flex-shrink-0" data-dept="engineering">Engineering</button>
                                <button class="dept-tab-button flex-shrink-0" data-dept="hr">HR</button>
                            </nav>
                        </div>
                        <div id="dept-content" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="bg-gray-50 p-4 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Quota Attainment</p>
                                    <p class="text-2xl font-bold text-green-600">103%</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Pipeline Coverage</p>
                                    <p class="text-2xl font-bold text-gray-800">3.5x</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Avg. Deal Size</p>
                                    <p class="text-2xl font-bold text-gray-800">$85k</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">Budget Adherence</p>
                                    <p class="text-2xl font-bold text-red-600">+3.1%</p>
                                </div>
                            </div>
                            <div class="text-base text-gray-700 space-y-3">
                                <p><strong class="font-semibold">Highlights:</strong> Exceeded quota, driven by strong performance in the new Enterprise segment. Landed two Fortune 500 logos.</p>
                                <p><strong class="font-semibold">Lowlights:</strong> Mid-market team struggled, hitting only 85% of their number. Budget overage due to higher commission payouts on large deals.</p>
                                <p><strong class="font-semibold">Next Period Focus:</strong> Double down on Enterprise playbook, provide additional training for mid-market reps.</p>
                                <p><strong class="font-semibold">Help Wanted:</strong> Need marketing to accelerate SQL delivery for the mid-market segment.</p>
                            </div>
                            <div class="flex justify-end mt-4">
                                <button onclick="navigateToAriaWithContext('sales-renewals')" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                    Dive Deeper with Aria
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function initializeTechFlowInteractions() {
            // Add any TechFlow-specific interactions here
            console.log('TechFlow dashboard loaded');
        }

        function initializeCloudVantageInteractions() {
            // Initialize QBR tabs
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContent = document.getElementById('tab-content');
            
            const tabContents = {
                summary: `<p>Q1 was a strong quarter, exceeding top-line revenue targets by 4% and maintaining a healthy Rule of 40 score of 58%. The Enterprise GTM strategy is showing early signs of success, with two major logos landed. Headwinds remain in product development, where the AI feature is behind schedule, and the new Channel Partner program is struggling to gain traction.</p>`,
                performance: `<p>Sales quota attainment was 103%, a significant achievement. Marketing delivered 115% of their MQL target, though conversion to SQL was slightly below plan at 8%. Customer churn remains low at 1.2% for the quarter, and NRR of 128% demonstrates strong expansion within the existing base. Engineering velocity was 15% below target due to resources being re-allocated to address platform scalability.</p>`,
                financials: `<p>Revenue came in at $20.2M for the quarter against a plan of $19.5M. EBITDA margin was 31%, slightly missing the 32% target due to unplanned cloud infrastructure spend and higher-than-expected commission payouts. The company remains well-capitalized with a healthy cash runway. We are tracking a slight budget overage in R&D, which is being closely monitored.</p>`,
                initiatives: `<p>The Enterprise GTM and ABM campaigns are both on track and delivering results. The Channel Partner program is 'At Risk' and requires a Q2 remediation plan. The AI-Powered Feature is 'Behind' and a revised timeline is being developed by the Product team. The Platform Scalability and Leadership Development programs are proceeding as planned.</p>`
            };
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const tab = button.getAttribute('data-tab');
                    tabContent.innerHTML = tabContents[tab];
                });
            });

            // Initialize Department tabs
            const deptButtons = document.querySelectorAll('.dept-tab-button');
            const deptContent = document.getElementById('dept-content');
            
            const deptContents = {
                sales: {
                    metrics: [
                        { label: 'Quota Attainment', value: '103%', color: 'text-green-600' },
                        { label: 'Pipeline Coverage', value: '3.5x', color: 'text-gray-800' },
                        { label: 'Avg. Deal Size', value: '$85k', color: 'text-gray-800' },
                        { label: 'Budget Adherence', value: '+3.1%', color: 'text-red-600' }
                    ],
                    content: `
                        <p><strong>Highlights:</strong> Exceeded quota, driven by strong performance in the new Enterprise segment. Landed two Fortune 500 logos.</p>
                        <p><strong>Lowlights:</strong> Mid-market team struggled, hitting only 85% of their number. Budget overage due to higher commission payouts on large deals.</p>
                        <p><strong>Next Period Focus:</strong> Double down on Enterprise playbook, provide additional training for mid-market reps.</p>
                        <p><strong>Help Wanted:</strong> Need marketing to accelerate SQL delivery for the mid-market segment.</p>
                    `,
                    context: 'sales-renewals'
                },
                marketing: {
                    metrics: [
                        { label: 'MQLs vs Target', value: '115%', color: 'text-green-600' },
                        { label: 'SQLs vs Target', value: '92%', color: 'text-yellow-600' },
                        { label: 'CAC', value: '$12.5k', color: 'text-gray-800' },
                        { label: 'Budget Adherence', value: '-1.5%', color: 'text-green-600' }
                    ],
                    content: `
                        <p><strong>Highlights:</strong> ABM campaign for Enterprise was a huge success, generating high-quality leads. Managed budget effectively.</p>
                        <p><strong>Lowlights:</strong> MQL-to-SQL conversion rate dropped, indicating some lead quality issues in our top-of-funnel content.</p>
                        <p><strong>Next Period Focus:</strong> Optimize lead scoring model, launch targeted mid-market campaigns.</p>
                        <p><strong>Help Wanted:</strong> Sales feedback on lead quality is critical to our optimization efforts.</p>
                    `,
                    context: 'marketing'
                },
                product: {
                    metrics: [
                        { label: 'Roadmap Adherence', value: '70%', color: 'text-red-600' },
                        { label: 'Feature Adoption', value: '45%', color: 'text-gray-800' },
                        { label: 'NPS', value: '52', color: 'text-green-600' },
                        { label: 'Budget Adherence', value: '+5.2%', color: 'text-red-600' }
                    ],
                    content: `
                        <p><strong>Highlights:</strong> Successfully launched two major platform enhancements which have received positive customer feedback and contributed to a high NPS score.</p>
                        <p><strong>Lowlights:</strong> The flagship AI-Powered Feature is significantly delayed due to unforeseen technical complexity. This has caused budget overruns.</p>
                        <p><strong>Next Period Focus:</strong> Finalize a revised, de-risked timeline for the AI feature. Conduct customer interviews to validate the next set of roadmap priorities.</p>
                        <p><strong>Help Wanted:</strong> Need engineering to provide a firm estimate on the remaining work for the AI feature to reset expectations.</p>
                    `,
                    context: 'product'
                },
                engineering: {
                    metrics: [
                        { label: 'Sprint Completion', value: '88%', color: 'text-yellow-600' },
                        { label: 'Cycle Time', value: '4.2d', color: 'text-gray-800' },
                        { label: 'Uptime', value: '99.98%', color: 'text-green-600' },
                        { label: 'Budget Adherence', value: '+2.8%', color: 'text-yellow-600' }
                    ],
                    content: `
                        <p><strong>Highlights:</strong> Maintained excellent platform stability and uptime. Successfully completed critical scalability work ahead of schedule.</p>
                        <p><strong>Lowlights:</strong> Team velocity was impacted by the complexity of the AI feature, leading to lower sprint completion rates. Some technical debt was incurred to meet deadlines.</p>
                        <p><strong>Next Period Focus:</strong> Dedicate one sprint to tech debt reduction. Finalize architecture for the AI feature.</p>
                        <p><strong>Help Wanted:</strong> Clearer, finalized requirements from Product for the AI feature to prevent further scope creep.</p>
                    `,
                    context: 'engineering'
                },
                hr: {
                    metrics: [
                        { label: 'Employee Attrition', value: '8%', color: 'text-green-600' },
                        { label: 'Time to Hire', value: '42d', color: 'text-gray-800' },
                        { label: 'eNPS', value: '65', color: 'text-green-600' },
                        { label: 'Budget Adherence', value: '-2.1%', color: 'text-green-600' }
                    ],
                    content: `
                        <p><strong>Highlights:</strong> Employee satisfaction (eNPS) is at an all-time high. Attrition remains well below industry average. The leadership development program is receiving excellent feedback.</p>
                        <p><strong>Lowlights:</strong> Time to hire for senior engineering roles remains a challenge.</p>
                        <p><strong>Next Period Focus:</strong> Launch a new employee referral program to improve the engineering talent pipeline. Complete the annual compensation review.</p>
                        <p><strong>Help Wanted:</strong> Engineering managers' participation in final-round interviews to speed up the hiring process.</p>
                    `,
                    context: 'hr'
                }
            };
            
            deptButtons.forEach(button => {
                button.addEventListener('click', () => {
                    deptButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const dept = button.getAttribute('data-dept');
                    const deptData = deptContents[dept];
                    
                    deptContent.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            ${deptData.metrics.map(metric => `
                                <div class="bg-gray-50 p-4 rounded-lg text-center">
                                    <p class="text-sm text-gray-600">${metric.label}</p>
                                    <p class="text-2xl font-bold ${metric.color}">${metric.value}</p>
                                </div>
                            `).join('')}
                        </div>
                        <div class="text-base text-gray-700 space-y-3 mt-4">
                            ${deptData.content}
                        </div>
                        <div class="flex justify-end mt-4">
                            <button onclick="navigateToAriaWithContext('${deptData.context}')" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                Dive Deeper with Aria
                            </button>
                        </div>
                    `;
                });
            });
        }

        // Add navigation function to Aria with context
        function navigateToAriaWithContext(context) {
            const selectedCompany = getSelectedCompany();
            localStorage.setItem('ariaContext', context);
            window.location.href = `aria.html?company=${selectedCompany}&context=${context}`;
        }

        // Listen for company selector changes in header
        document.addEventListener('change', (e) => {
            if (e.target.id === 'company-selector') {
                const newCompany = e.target.value;
                if (newCompany === 'all') {
                    window.location.href = 'index.html';
                } else {
                    window.location.href = `portco.html?company=${newCompany}`;
                }
            }
        });
    </script>
</body>
</html>
